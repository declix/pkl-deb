/// Comprehensive tests for SourcesList module
amends "pkl:test"

import "../SourcesList.pkl"

examples {
    ["Basic entry"] {
        new SourcesList.Entry {
            archiveType = "deb"
            uri = "http://deb.debian.org/debian"
            suite = "bookworm"
            components = new Listing { "main" }
        }
    }
    
    ["Entry with multiple components"] {
        new SourcesList.Entry {
            archiveType = "deb"
            uri = "http://deb.debian.org/debian"
            suite = "bookworm"
            components = new Listing { "main"; "contrib"; "non-free" }
        }
    }
    
    ["Source repository entry"] {
        new SourcesList.Entry {
            archiveType = "deb-src"
            uri = "http://deb.debian.org/debian" 
            suite = "bookworm"
            components = new Listing { "main" }
        }
    }
    
    ["Entry with architecture option"] {
        new SourcesList.Entry {
            archiveType = "deb"
            options = new SourcesList.EntryOptions {
                architectures = new Listing { "amd64"; "i386" }
            }
            uri = "http://deb.debian.org/debian"
            suite = "bookworm"
            components = new Listing { "main" }
        }
    }
    
    ["Entry with multiple options"] {
        new SourcesList.Entry {
            archiveType = "deb"
            options = new SourcesList.EntryOptions {
                architectures = new Listing { "amd64" }
                trusted = true
                signedBy = "/usr/share/keyrings/example.gpg"
            }
            uri = "http://example.com/debian"
            suite = "bookworm"
            components = new Listing { "main" }
        }
    }
    
    ["Entry with PDiffs disabled"] {
        new SourcesList.Entry {
            archiveType = "deb"
            options = new SourcesList.EntryOptions {
                pdiffs = false
            }
            uri = "http://deb.debian.org/debian"
            suite = "bookworm"
            components = new Listing { "main" }
        }
    }
    
    ["Basic Debian sources.list"] {
        new SourcesList.SourcesList {
            entries = new Listing {
                new SourcesList.Entry {
                    archiveType = "deb"
                    uri = "http://deb.debian.org/debian"
                    suite = "bookworm"
                    components = new Listing { "main"; "contrib"; "non-free" }
                }
                new SourcesList.Entry {
                    archiveType = "deb"
                    uri = "http://deb.debian.org/debian"
                    suite = "bookworm-updates"
                    components = new Listing { "main"; "contrib"; "non-free" }
                }
                new SourcesList.Entry {
                    archiveType = "deb"
                    uri = "http://security.debian.org/debian-security"
                    suite = "bookworm-security"
                    components = new Listing { "main"; "contrib"; "non-free" }
                }
            }
        }
    }
    
    ["Ubuntu sources.list with options"] {
        new SourcesList.SourcesList {
            entries = new Listing {
                new SourcesList.Entry {
                    archiveType = "deb"
                    options = new SourcesList.EntryOptions {
                        architectures = new Listing { "amd64" }
                    }
                    uri = "http://archive.ubuntu.com/ubuntu"
                    suite = "jammy"
                    components = new Listing { "main"; "restricted" }
                }
                new SourcesList.Entry {
                    archiveType = "deb"
                    uri = "http://security.ubuntu.com/ubuntu"
                    suite = "jammy-security"
                    components = new Listing { "main"; "restricted" }
                }
            }
        }
    }
    
    ["Mixed source and binary repositories"] {
        new SourcesList.SourcesList {
            entries = new Listing {
                new SourcesList.Entry {
                    archiveType = "deb"
                    uri = "http://deb.debian.org/debian"
                    suite = "sid"
                    components = new Listing { "main"; "contrib"; "non-free" }
                }
                new SourcesList.Entry {
                    archiveType = "deb-src"
                    uri = "http://deb.debian.org/debian"
                    suite = "sid"
                    components = new Listing { "main"; "contrib"; "non-free" }
                }
            }
        }
    }
    
    ["Docker repository with signing key"] {
        new SourcesList.SourcesList {
            entries = new Listing {
                new SourcesList.Entry {
                    archiveType = "deb"
                    options = new SourcesList.EntryOptions {
                        architectures = new Listing { "amd64" }
                        signedBy = "/usr/share/keyrings/docker-archive-keyring.gpg"
                    }
                    uri = "https://download.docker.com/linux/debian"
                    suite = "bookworm"
                    components = new Listing { "stable" }
                }
            }
        }
    }
}