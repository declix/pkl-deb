/// Tests for Deb822 module
amends "pkl:test"

import "../Deb822.pkl"

examples {
  ["Simple field"] {
    Deb822.field("Name", "value")
  }
  
  ["Boolean field true"] {
    Deb822.booleanField("Enabled", true)
  }
  
  ["Boolean field false"] {
    Deb822.booleanField("Trusted", false)
  }
  
  ["List field"] {
    Deb822.listField("Components", new Listing { "main"; "contrib"; "non-free" })
  }
  
  ["Multiline field"] {
    Deb822.multilineField("Description", "This is a long description\nthat spans multiple lines\nand preserves formatting")
  }
  
  ["Field with continuation line"] {
    new Deb822.Field {
      name = "Long-Field"
      value = "This is a very long value that might\nspan across multiple lines"
    }
  }
  
  ["Simple stanza"] {
    new Deb822.Stanza {
      fields = new Listing {
        Deb822.field("Types", "deb")
        Deb822.field("URIs", "http://deb.debian.org/debian")
        Deb822.field("Suites", "bookworm")
        Deb822.listField("Components", new Listing { "main"; "contrib" })
      }
    }
  }
  
  ["Stanza with optional fields"] {
    new Deb822.Stanza {
      fields = new Listing {
        Deb822.field("Types", "deb")
        Deb822.field("URIs", "https://download.docker.com/linux/debian")
        Deb822.field("Suites", "bookworm")
        Deb822.field("Components", "stable")
        Deb822.listField("Architectures", new Listing { "amd64" })
        Deb822.field("Signed-By", "/usr/share/keyrings/docker-archive-keyring.gpg")
        Deb822.booleanField("Trusted", false)
      }
    }
  }
  
  ["Document with single stanza"] {
    new Deb822.Document {
      stanzas = new Listing {
        new Deb822.Stanza {
          fields = new Listing {
            Deb822.field("Types", "deb")
            Deb822.field("URIs", "http://deb.debian.org/debian")
            Deb822.field("Suites", "bookworm")
            Deb822.field("Components", "main")
          }
        }
      }
    }
  }
  
  ["Document with multiple stanzas"] {
    new Deb822.Document {
      stanzas = new Listing {
        new Deb822.Stanza {
          fields = new Listing {
            Deb822.field("Types", "deb")
            Deb822.field("URIs", "http://deb.debian.org/debian")
            Deb822.field("Suites", "bookworm")
            Deb822.field("Components", "main contrib non-free")
          }
        }
        new Deb822.Stanza {
          fields = new Listing {
            Deb822.field("Types", "deb")
            Deb822.field("URIs", "http://security.debian.org/debian-security")
            Deb822.field("Suites", "bookworm-security")
            Deb822.field("Components", "main contrib non-free")
          }
        }
      }
    }
  }
  
  ["Document with header comment"] {
    new Deb822.Document {
      headerComment = "Debian Bookworm repository configuration\nGenerated by Pkl"
      stanzas = new Listing {
        new Deb822.Stanza {
          fields = new Listing {
            Deb822.field("Types", "deb")
            Deb822.field("URIs", "http://deb.debian.org/debian")
            Deb822.field("Suites", "bookworm")
            Deb822.field("Components", "main")
          }
        }
      }
    }
  }
}